{% extends "base.html" %}

{% load staticfiles %}
{% load widget_tweaks %}
{% load markdownx %}

{% block title %}{{ block.super }} | {{ object.name }}{% endblock title %}

{% block stylesheets %}
{{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static 'css/modal.css' %}">
  <!-- Include Bootstrap Datepicker -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker.min.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker3.min.css" />
{% endblock stylesheets %}

{% block js %}
{{ block.super }}
  <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/locales/bootstrap-datepicker.ru.js"></script>
  <script type="text/javascript" src="{% static 'js/matches.js' %}"></script>
  <script type="text/javascript">
    var matchListUrl = "{% url 'match-list' %}",
        season = {{ object.pk }};
  </script>

{% endblock js %}

{% block content %}

<h2 id="name"><a href="{{ object.tourn.get_absolute_url }}">{{ object.name }}</a></h2>

<article>{{ object.story | markdown }}</article>

{% for group in object.groups.all %}
{% include 'matches/season_table.html' with object=group %}
{% endfor %}

{% if not user.is_anonymous %}
<form role="form" id="addMatch" class="addForm" style="display: none;">
{% csrf_token %}

<div id="formErrors">
  {% if form.errors %}
      {{ form.non_field_errors }}
      {% for field in form %}
      <div class="fieldError">
          {{ field.errors }}
      </div>
      {% endfor %}
  {% endif %}
  </div>
  
<h3>Добавить матч</h3>
<div class="form-inputs">
  <input type="hidden" 
         name="tourn_season" 
         id="id_tourn_season" 
         value="{{ match_form.tourn_season.value }}">

  <div class="row">
    <div class="col-sm-2 text-center">
      <span class="help-block">{{ match_form.date.label }}</span>
    </div>
    <div class="col-sm-3 text-center has-error">
      <span class="help-block">{{ match_form.home.label }}</span>
    </div>
    <div class="col-sm-3 text-center has-error">
      <span class="help-block">{{ match_form.away.label }}</span>
    </div>
    <div class="col-sm-2 text-center">
      <span class="help-block">Счет</span>
    </div>
    <div class="col-sm-2 text-center">
      <span class="help-block">Счет 1 тайма</span>
    </div>
  </div>
  <div class="form-group row">
    <div class="col-sm-2">
      {% render_field match_form.date class+="form-control" %}
    </div>
    <div class="col-sm-3">
      {% render_field match_form.home %}
    </div>
    <div class="col-sm-3">
      {% render_field match_form.away class+="form-control" %}
    </div>
    <div class="col-sm-1">
      {% render_field match_form.home_score class+="form-control" %}
    </div>
    <div class="col-sm-1">
      {% render_field match_form.away_score class+="form-control" %}
    </div>
    <div class="col-sm-1">
      {% render_field match_form.home_halfscore class+="form-control" %}
    </div>
    <div class="col-sm-1">
      {% render_field match_form.away_halfscore class+="form-control" %}
    </div>
  </div>

  <div class="form-group row">
    <div class="col-sm-12">
      {% render_field match_form.story class+="form-control" rows="2" %}
      <span class="help-block">Произвольная информация о матче</span>
    </div>
  </div>
</div>

{{ match_form.media }}

  <div class="pull-right">
    <button class="btn btn-default submitForm" 
            id="submitMatchForm" 
            type="button">Сохранить</button>
    <button class="btn btn-secondary cancelForm" 
            id="cancelMatchForm" 
            type="button">Отмена</button>
  </div>
</form>

  <div class="pull-right">
    <button class="btn btn-default showForm" 
            id="showMatchForm" 
            type="button">Добавить</button>
  </div>
{% endif %}

{% include '_modal.html' with modal_id="moderationModal" %}

{% if object.documents %}
  {% include '_documents.html' %}
{% endif %}

<div>
  <ul class="pagination">
    {% if prev %}
      <li>
        <a href="{{ prev.get_absolute_url }}">
          ❮ {{ prev }}</a>
      </li>
    {% endif %}
    {% if next %}
      <li>
        <a href="{{ next.get_absolute_url }}">
          {{ next }} ❯</a>
      </li>
    {% endif %}
  </ul>
</div>

{% endblock content %}
