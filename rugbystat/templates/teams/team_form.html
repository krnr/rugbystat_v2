{% extends "base.html" %}
{% load staticfiles %}
{% load widget_tweaks %}
{% load markdownx %}

{% block title %}{{ block.super }} | {{object.name}} {{ object.city.name }}{% endblock title %}

{% block stylesheets %}

{{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static 'css/modal.css' %}">
  <!-- Include Bootstrap Datepicker -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker.min.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker3.min.css" />
{% endblock stylesheets %}

{% block js %}

{{ block.super }}
  <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.min.js"></script>
  <script type="text/javascript" src="{% static 'js/teams.js' %}"></script>
  <script type="text/javascript">
    var teamListUrl = "{% url 'team-list' %}",
        teamSeasonListUrl = "{% url 'teamseason-list' %}",
        teamUpdate = "{% url 'teams_detail' pk=object.pk %}",
        team = {{ object.pk }};
  </script>
{% endblock js %}

{% block content %}
<div class="form-group">
  <label class="control-label" for="focusedInput">&nbsp;</label>
  <div class="input-group">
    <input type="search" class="form-control" id="team-input" />
    <span class="input-group-btn">
      <button class="btn btn-default" id="search-submit-btn" type="button">Искать</button>
    </span>
  </div>
</div>

<span id="indicator" style="display:none;"><img src="http://upload.wikimedia.org/wikipedia/commons/d/de/Ajax-loader.gif"/></span>
<div id="results"></div>

<div class="pull-right">
  {% if user.is_authenticated %}
  <button class="btn btn-default" id="showTeamForm" type="button">Редактировать</button>
  {% endif %}
</div>

<h2 id="name" class="editable">{{ object.name }} {{ object.city.name }} ({{ object.operational_years }})</h2>

<div id="formErrors">
{% if form.errors %}
    {{ form.non_field_errors }}
    {% for field in form %}
    <div class="fieldError">
        {{ field.errors }}
    </div>
    {% endfor %}
{% endif %}
</div>

<form role="form" id="teamForm"
      method="POST" action="{% url 'teams_detail' pk=object.pk %}"
      style="display: none;">
{% csrf_token %}
<div id="dossierForm" class="form-inputs">
  <div class="form-inline row">
    <div class="col-sm-3">
      {% render_field form.year_prefix class+="form-control" %}
      <span class="help-block">{{ form.year_prefix.label }}</span>
    </div>
    <div class="col-sm-3">
      {% render_field form.year class+="form-control" %}
      <span class="help-block">{{ form.year.label }}</span>
    </div>
    <div class="col-sm-3">
      {% render_field form.disband_year_prefix class+="form-control" %}
      <span class="help-block">{{ form.disband_year_prefix.label }}</span>
    </div>
    <div class="col-sm-3">
      {% render_field form.disband_year class+="form-control" %}
      <span class="help-block">{{ form.disband_year.label }}</span>
    </div>
  </div>
</div>
<div id="storyForm" class="form-inputs">
  <div class="form-group">
    {% render_field form.story class+="form-control" rows="5" %}
    <span class="help-block">{{ form.story.label }}</span>
  </div>
</div>
<div id="submitForm">
  <div class="form-group">
    <button class="btn btn-default" id="submitTeamForm" type="submit">Сохранить</button>
    <button class="btn btn-secondary" id="cancelTeamForm" type="submit">Отмена</button>
  </div>
</div>
</form>

{{ form.media }}

<div id="dossier" class="editable">
  <b>Годы:</b> {{ object.operational_years }}
</div>

{% if object.names.all %}
<b>Названия:</b>
<ul>
{% for name in object.names.all %}
<li>{{ name }}</li>
{% endfor %}
</ul>
{% endif %}

<div id="story" class="editable">
  <b>История:</b>
  <div>{{ object.story | markdown }}</div>
</div>

<form role="form" id="addSeason" class="addForm" style="display: none;">
  {% csrf_token %}
  
  <div id="formErrors">
    {% if form.errors %}
        {{ form.non_field_errors }}
        {% for field in form %}
        <div class="fieldError">
            {{ field.errors }}
        </div>
        {% endfor %}
    {% endif %}
    </div>

{% if user.is_authenticated %}

  <h3>Добавить сезон</h3>
  <div class="form-inputs">
    <input type="hidden" 
           name="team" 
           id="id_team" 
           value="{{ season_form.team.value }}">
  
    <div>
      <div class="col-sm-3 text-center">
        <span class="help-block">{{ season_form.season.label }}</span>
      </div>
      <div class="col-sm-2 text-center">
        <span class="help-block">{{ season_form.name.label }}</span>
      </div>
      <div class="col-sm-1 text-center has-error">
        <span class="help-block">{{ season_form.place.label }}</span>
      </div>
      <div class="col-sm-1 text-center has-error">
        <span class="help-block">{{ season_form.played.label }}</span>
      </div>
      <div class="col-sm-1 text-center has-error">
        <span class="help-block">{{ season_form.wins.label }}</span>
      </div>
      <div class="col-sm-1 text-center">
        <span class="help-block">{{ season_form.draws.label }}</span>
      </div>
      <div class="col-sm-1 text-center">
        <span class="help-block">{{ season_form.losses.label }}</span>
      </div>
      <div class="col-sm-1 text-center">
        <span class="help-block">{{ season_form.points.label }}</span>
      </div>
      <div class="col-sm-1 text-center">
        <span class="help-block">{{ season_form.score.label }}</span>
      </div>
    </div>
    <div class="form-group row">
      <div class="col-sm-3">
        {% render_field season_form.season class+="form-control" %}
      </div>
      <div class="col-sm-2">
        {% render_field season_form.name class+="form-control" %}
      </div>
      <div class="col-sm-1">
        {% render_field season_form.place class+="form-control" %}
      </div>
      <div class="col-sm-1">
        {% render_field season_form.played class+="form-control" %}
      </div>
      <div class="col-sm-1">
        {% render_field season_form.wins class+="form-control" %}
      </div>
      <div class="col-sm-1">
        {% render_field season_form.draws class+="form-control" %}
      </div>
      <div class="col-sm-1">
        {% render_field season_form.losses class+="form-control" %}
      </div>
      <div class="col-sm-1">
        {% render_field season_form.points class+="form-control" %}
      </div>
      <div class="col-sm-1">
        {% render_field season_form.score class+="form-control" %}
      </div>
    </div>
  
    <div class="form-group row">
      <div class="col-sm-12">
        {% render_field season_form.story class+="form-control" rows="2" %}
        <span class="help-block">Произвольная информация о сезоне</span>
      </div>
    </div>
  </div>
  
  {{ season_form.media }}
  
    <div class="pull-right">
      <button class="btn btn-default submitForm" 
              id="submitSeasonForm" 
              type="button">Сохранить</button>
      <button class="btn btn-secondary cancelForm" 
              id="cancelSeasonForm" 
              type="button">Отмена</button>
    </div>
  </form>
  
    <div class="pull-right">
      <button class="btn btn-default showForm" 
              id="showTeamSeasonForm" 
              type="button">Добавить сезон</button>
    </div>
  
{% endif %}

{% if object.seasons.all %}
<h3>Сезоны</h3>
<table class="table table-striped table-hover" id="person-seasons">
<thead>
  <tr>
    <th>Турнир</th>
    <th>И</th>
    <th>В</th>
    <th>Н</th>
    <th>П</th>
    <th>Р/О</th>
    <th>О</th>
  </tr>
</thead>
<tbody>
{% for season in seasons %}
  <tr class="document-row">
    <td> 
      <a class="link" href="{{ season.get_absolute_url }}">
         {{ season.season }}
      </a>
    </td>
    {% include 'matches/table_row.html' with team=season %}
  </tr>
{% endfor %}
</tbody></table>
{% endif %}

{% if documents %}
<h3>Документы</h3>
  {% include '_documents.html' with queryset=documents %}
{% endif %}

{% include '_modal.html' with modal_id="moderationModal" %}

{% endblock content %}
